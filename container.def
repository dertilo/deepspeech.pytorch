BootStrap: localimage
From: /home/tilo/code/UTIL/containerizing/singularity/pytorch.sif #see https://github.com/dertilo/containerizing.git

%files
    ./requirements.txt /root/requirements.txt

%post

    PATH="/opt/conda/bin:$PATH"
    pip install -r /root/requirements.txt

    git clone https://github.com/SeanNaren/warp-ctc.git
    export CUDA_HOME="/usr/local/cuda"
    cd warp-ctc; mkdir build; cd build; cmake ..; make  && cd ..
    cd pytorch_binding; python setup.py install && cd ..

    pip install torchaudio==0.3.0

    git clone --recursive https://github.com/parlance/ctcdecode.git
    cd ctcdecode; pip install .  && cd ..

    git clone --recursive https://github.com/NVIDIA/apex.git
    cd apex; pip install .  && cd ..